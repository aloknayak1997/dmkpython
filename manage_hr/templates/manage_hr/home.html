{% extends 'base.html' %} {% block title %} HR Management {% endblock %} {% block content %} {% load static %}
<link rel="stylesheet" href="{% static 'hr_style.css'%}">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
    crossorigin="anonymous">
<style>
    div.block {
        box-shadow: 1px 1px 20px -7px;
        padding: 27px;
        margin-bottom: 1%;
    }

    .bar {
        box-shadow: 1px 1px 5px -2px;
        padding: 32px 38px;
    }

    div#add {
        transform: scale(2.2);
        margin: 17px 0 0 31px;
        float: right;
    }

    div.tab {
        background: #d0cfcf;
        border-radius: 20px;
        padding: 5px;
        display: inline-flex;
    }

    .close:not(:disabled):not(.disabled) {
        cursor: pointer;
    }

    .close {
        right: 32px;
        width: 32px;
        height: 32px;
        float: none;
        opacity: 0.3;
    }

    i.far.fa-times-circle {
        padding: 4px;
    }

    .close {
        font-size: 1.5rem;
        font-weight: 700;
        line-height: 1;
        color: #000;
        text-shadow: 0 1px 0 #fff;
        opacity: .5;
    }
</style>
<div class="data-head">
    <span>Add Employe</span>
</div>
<form method="POST" class="data">
    {% csrf_token %}

    <span class="data-head">Basic Details</span>
    <div class="block">
        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-user"></i>
            </span>

            <input class="input" id="fname" placeholder="First Name"> </input>
        </div>


        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-user"></i>
            </span>

            <input class="input" id="mname" placeholder="Middle Name"> </input>
        </div>


        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-user"></i>
            </span>

            <input class="input" id="lname" placeholder="Last Name"> </input>
        </div>

        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-chalkboard-teacher"></i>
            </span>

            <select id="desig" class="input">
                <optgroup>
                    <option>Designation</option>
                    <option value="Teaching Staff">Teaching Staff</option>
                    <option value="Non-Teaching Staff">Non-Teaching Staff</option>
                    <option value="Part-time Staff">Part-time Staff</option>
                    <option value="HR Staff">HR Staff</option>
                    <option value="Guest lecture">Guest lecture</option>
                    <option value="Other">Other</option>
                </optgroup>
            </select>
        </div>

        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-building"></i>
            </span>

            <select id="depart" class="input">
                <optgroup>
                    <option>Department</option>
                    <option value="Admin">Admin</option>
                    <option value="Accounts">Accounts</option>
                    <option value="Teaching">Teaching</option>
                </optgroup>
            </select>
        </div>
        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-user"></i>
            </span>

            <select id="gender" class="input">
                <optgroup>
                    <option>Gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                </optgroup>
            </select>
        </div>


        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-mobile-alt"></i>
            </span>

            <input id="mobno" maxlength="10" minlength="10" class="input" type="text" onkeypress='validate(event)' placeholder="Mobile Number"> </input>
        </div>
        <!-- <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-rupee-sign"></i>
            </span>
            <input id="salary" class="input" type="number" placeholder="salary"> </input>
        </div> -->
        <div class="input-feilds">
            <span class="fa-icons">
                <i class="fas fa-at"></i>
            </span>
            <input id="email" class="input" type="email" placeholder="Email" />
        </div>
        <div class="in-feilds">
            <span style="margin-bottom:2px; font-size: 11px;">Date of Join</span>
            <div class="input-feilds">
                <span class="fa-icons">
                    <i class="fas fa-calendar-alt"></i>
                </span>
                <input id="date" placeholder="Date Of Birth..." oninput="this.className = ''" class="" name="date_of_birth" id="date_of_birth"
                    type="date">
            </div>
        </div>

    </div>

    <div class="block">
        <div class="bar">

            <div class="input-feilds">
                <span class="fa-icons">
                    <i class="fas fa-mobile-alt"></i>
                </span>
                <select id="leavename" class="input">
                    <optgroup>
                        <option>Select Leave</option>
                        <option data-id="casual_leaves" value="Casual leaves">Casual leaves</option>
                        <option data-id="paid_leaves" value="Paid leaves">Paid leaves</option>
                        <option data-id="sick_leaves" value="Sick leaves">Sick leaves</option>
                        <option value="Others">Others</option>
                    </optgroup>
                </select>
            </div>
            <div class="input-feilds other" style="margin: 2%; display:none;">
                <span class="fa-icons">
                    <i class="fas fa-mobile-alt"></i>
                </span>
                <input id="otherleavename" maxlength="10" minlength="10" class="input" type="text" placeholder="Leave Name"> </input>
            </div>
            <div class="input-feilds " style="margin: 2%;">
                <span class="fa-icons">
                    <i class="fas fa-mobile-alt"></i>
                </span>
                <input id="leavenum" maxlength="20" class="input" type="text" onkeypress='validate(event)' placeholder="Number of Leaves"> </input>
            </div>
            <div id="add">
                <i class="fas fa-plus-circle"></i>
            </div>
            <div id="leave_tab"></div>
        </div>
    </div>
    <input id="save" type="button" value="Add" />
</form>


<script>
    var fulldate, desig, depart, gender, leavename, leavenameslect, leavenum;

    function validate(evt) {
        var theEvent = evt || window.event;

        // Handle paste
        if (theEvent.type === 'paste') {
            key = event.clipboardData.getData('text/plain');
        } else {
            // Handle key press
            var key = theEvent.keyCode || theEvent.which;
            key = String.fromCharCode(key);
        }
        var regex = /[0-9]|\./;
        if (!regex.test(key)) {
            theEvent.returnValue = false;
            if (theEvent.preventDefault) theEvent.preventDefault();
        }
    }
    $("#date").change(function () {
        var date = new Date($('#date').val());
        day = date.getDate();
        month = date.getMonth() + 1;
        year = date.getFullYear();
        fulldate = [day, month, year].join('/');
    });
    $("select#leavename").change(function () {
        leavenameslect = $("#leavename option:selected").val();
        if (leavenameslect == "Others") {
            $('.other').css('display', 'inline-flex');
        }
    });
    $("select#desig").change(function () {
        desig = $("#desig option:selected").val();
    });
    $("select#depart").change(function () {
        depart = $("#depart option:selected").val();
    });
    $("select#gender").change(function () {
        gender = $("#gender option:selected").val();
    });

    $('#add').click(function () {
        var add = true;
        if (leavenameslect == "Others") {
            leavename = $('#otherleavename').val();
        }
        else {
            leavename = leavenameslect;
        }
        leavenum = $('#leavenum').val();
        var namevalue, numvalue;
        var ldata = [];
        var tabs = document.getElementsByClassName('tab');
        for (i = 0; i < tabs.length; i++) {
            var name = tabs[i].getElementsByClassName('name');
            var num = tabs[i].getElementsByClassName('num');
            for (j = 0; j < name.length; j++) {
                namevalue = name[j].innerHTML;
                numvalue = num[j].innerHTML;
                ldata.push(namevalue);
                ldata.push(numvalue);
            }
        }
        console.log(ldata);
        console.log(leavename, leavenum);
        for (var i = 0, len = ldata.length; i < len; i++) {
            if (ldata[i] == leavename) {
                //2 exists
                add = false;
                $('.notification').append("<div class='overlay'> <div class='close'></div>You have already added this leave !!</div>");
                break;
            }
        }
        html = "<div class='tab'>";
        html += "<span class='name'>" + leavename + "</span>";
        html += "<span class='num'>" + leavenum + "</span>";
        html += "<i class='far fa-times-circle'></i>";
        html += "</div>";
        if (add == true) {
            $("#leave_tab").append(html);
        }

    });

    $(document).on('click', '.tab, i.far.fa-times-circle', function () { $(this).remove(); });

    $('#save').click(function () {
        var tabs = document.getElementsByClassName('tab');
        var fname = $('#fname').val();
        var mname = $('#mname').val();
        var lname = $('#lname').val();
        var mobno = $('#mobno').val();
        var email = $('#email').val();
        // var salary = $('#salary').val();
        var data = [];
        // data.push(fname, mname, lname, mobno, email, fulldate, desig, depart, gender, salary);
        data.push(fname, mname, lname, mobno, email, fulldate, desig, depart, gender);
        console.log(data);
        if (fname == '' && mname == '' && lname == '' && mobno == '' && email == '' && fulldate == '' && desig == '' && depart == '' && gender == '') {
            alert("Enter details");
            $('.notification').append("<div class='overlay'> <div class='close'></div>Please Try again !!</div>");
        }
        else {

            $.ajax({
                url: 'insert_emp/',
                type: 'POST',
                headers: { "X-CSRFToken": getCookie("csrftoken") },
                enctype: "multipart/form-data",
                data: {
                    'studentData': data,
                },
                dataType: 'json',
                success: function (data) {
                    if (data.Status) {
                        var empid=data.empid;
                        console.log(empid)
                        $('.notification').append("<div class='overlay green'> <div class='close'></div>Employe Added Successfully!!</div>");
                        for (i = 0; i < tabs.length; i++) {
                            var name = tabs[i].getElementsByClassName('name');
                            var num = tabs[i].getElementsByClassName('num');
                            for (j = 0; j < name.length; j++) {
                                var namevalue = name[j].innerHTML;
                                var numvalue = num[j].innerHTML;
                                var data = [];
                                data.push(empid,namevalue, numvalue);
                                console.log(data);
                                if (empid == '' && namevalue == '' && numvalue == '') {
                                    alert("Enter details");
                                    $('.notification').append("<div class='overlay'> <div class='close'></div>Please Try again !!</div>");
                                }
                                else {

                                    $.ajax({
                                        url: 'insert_leave/',
                                        type: 'POST',
                                        headers: { "X-CSRFToken": getCookie("csrftoken") },
                                        enctype: "multipart/form-data",
                                        data: {
                                            'studentData': data,
                                        },
                                        dataType: 'json',
                                        success: function (data) {
                                            if (data.Status) {
                                                $('.notification').append("<div class='overlay green'> <div class='close'></div>Leave Added Successfully!!</div>");

                                            }
                                            else {
                                                $('.notification').append("<div class='overlay'> <div class='close'></div>Please Try again !!</div>");
                                            }
                                        }
                                    });
                                }
                            }
                        }
                    }
                    else {
                        $('.notification').append("<div class='overlay'> <div class='close'></div>Please Try again !!</div>");
                    }
                }
            });
        }

    });


</script> {% endblock %}