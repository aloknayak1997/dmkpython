{% extends 'base.html' %} {% block content %} {% load static %}
<!-- <link rel="stylesheet" href="{% static 'hr_style.css'%}"> -->
<style>
    div#div_classes {
        padding: 35px;
        display: flex;
    }

    .input {
        margin: 20px;
        z-index: 99;
    }

    select.input {
        border: 1px solid #aaaaaa;
        padding: 4px;
        border-radius: 5px;
        font-family: Ubuntu;
        font-weight: 500;
        background: #fff;
        color: #99999c;
    }

    .active {
        display: grid !important;

    }

    .choices {
        display: none;
        overflow: auto;
        background: #fff;
        padding: 0 4px;
        position: absolute;
        max-height: 66%;
        box-shadow: 1px 1px 20px -7px;
    }

    .button {
        border: 1px solid #aaaaaa;
        padding: 4px;
        border-radius: 5px;
        font-family: Ubuntu;
        font-weight: 500;
        background: #fff;
        color: #99999c;
    }

    .data-tab {
    display: inline-grid;
    padding: 19px;
    box-shadow: 1px 1px 20px -10px;
    margin: 21px;
}
label.radio {
    padding: 0 15px;
}
    .none {
        display: none;
    }
</style>

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt"
    crossorigin="anonymous">
<link rel="stylesheet" href="http://wenzhixin.net.cn/p/multiple-select/multiple-select.css" />
<div style="margin-bottom: -20px">
    <div class="" style="margin-left: 10px">
        <a class="btn-floating waves-effect waves-light title-back-btn" onclick="window.history.back();" onmouseover="" style="cursor: pointer;">
            <img src="/media/icons8-left-64.png" style="height: 45px;width: 45px; margin-bottom:5px;"> </a>
        <span class="grey-text text-darken-2" style="font-size: 1.64rem;line-height: 52px; margin-left: 50px;">Pay</span>
    </div>

</div>
<hr>

<div class="col s12 m12 l12 padding-right-0 " style="padding-bottom:10%;">

    <div class="table">
        <div class="card grey lighten-5 card_align_left">
            <div class="card-content white-text list_view">
                <div style="display: inline;">

                    <form action="{% url 'fees_management:add_fee' %}" method="post" enctype="multipart/form-data">
                        <div id="div_classes">
                            <select id="class" class="input">
                                <option>Select Class</option>
                                {% for key,value in section_class.items %}
                                <option class_id="{{value.class_id}}" value="{{value.class_sec}}">{{value.class_sec}}</option>
                                {% endfor %}
                            </select>

                            <select class="input">
                                <option>Select Student</option>
                                {% for student in students %}
                                <option class="students" data-class="{{student.student_class}}{{student.section}}" student-id="{{student.id}}" value="{{student.first_name}}">{{student.first_name}}</option>
                                {% endfor %}
                            </select>

                            <div class="input">
                                <input class="button" type="button" value="Select Fee Type">
                                <div class="choices">
                                    {% for fee in fees %}
                                    <span class="fees" class-id="{{fee.institute_class_id}}">
                                        <input class="feeselect" name="{{fee.display_name}}" amount="{{fee.amount}}" 
                                        {% if fee.cycle == 3 %}
                                        cycle="Monthly"
                                        {% elif fee.cycle == 2 %}
                                        cycle="Half yearly"
                                        {% elif fee.cycle == 1 %}
                                        cycle="Annualy"
                                        {% endif %}
                                        type="checkbox" cycle_num="{{fee.cycle}}" value="{{fee.fee_type_id}}"/>{{fee.display_name}}</span>
                                    {% endfor %}
                                    <span class="none">No fees</span>
                                </div>
                            </div>
                            <div id="send" class="input" style="transform: scale(2.6); margin: 3.8% 0 0 29px;">
                                <i class="fas fa-arrow-circle-right"></i>
                            </div>
                        </div>
                        <!--    
                        <input class="button" type="button" id="add" name="submit" value="Add"> -->
                    </form>


                </div>
            </div>
        </div>
        <div class="card grey lighten-5 card_align_left">
            <div class="card-content white-text list_view">
                    <div class="total" style="margin: 29px 25px;"></div>   
                <div id="data" style="">
                    
                </div>
                <div class='mop' style="display: none;padding: 21px;">
                        <label class="radio">
                            <input type='radio' checked value="cash" name="mop"/>CASH</label>
                        <label class="radio">
                            <input type='radio' value="cheque" name="mop"/>Cheque</label>
                        <label class="radio">
                            <input type='radio' value="bank" name="mop" />Bank Deposit</label>
                    </div>
                    <div class="actions">
                        
                    </div> 
            </div>
        </div>
    </div>
    <script type="text/javascript">
        var total=0;
         $('.button').click(function () {
            $('.choices').toggleClass("active");
        });
        $('.multiple').css('width', '20%').val('Select Fee Type');

        $("select#class").change(function () {
            var classname = $("#class option:selected").val();
            var classid = $("#class option:selected").attr('class_id');
            console.log(classid);
            var students = document.getElementsByClassName('students');
            var fees = document.getElementsByClassName('fees');
            for (i = 0; i < students.length; i++) {
                students[i].style.display = "block";
                var classess = students[i].getAttribute("data-class").replace('th', '');
                if (classess != classname) {
                    students[i].style.display = "none";
                }
            }
            for (i = 0; i < fees.length; i++) {
                fees[i].style.display = "block";
                var id = fees[i].getAttribute("class-id");
                if (id != classid) {
                    fees[i].style.display = "none";
                }
            }
        });

        $('#send').click(function () {
            $('.mop').css('display','block');
            $('#data').html('');
            var selectedfees = document.getElementsByClassName('feeselect');
            for (i = 0; i < selectedfees.length; i++) {
                cycle = "";
                if (selectedfees[i].checked) {
                    name = selectedfees[i].getAttribute("name");
                    amount = selectedfees[i].getAttribute("amount");
                    cycle = selectedfees[i].getAttribute("cycle");
                    cycle_num = selectedfees[i].getAttribute("cycle_num");
                    var card = "<div class='data-tab'>";
                        card += "<div><h3>" + name + "</h3></div>";
                        card += "<div> Amount:"+" "+ amount + "</div>";
                    if (cycle_num == "1") {
                        total+=parseInt(amount);
                        console.log("name:" + name + " " + "amount:" + amount + " " + "cycle:Annualy");
                        // console.log("name:" + name + " " + "amount:" + amount + " " + "cycle:" + cycle+ " " + "cycle_num:" + cycle_num);     
                        card += "<div>Cycle"+" "+ cycle + "</div>";
                        card +="<select class='input'><option value='Annual'>Annual</option></select>";
                    }
                    else if (cycle_num == '2') {
                        total+=2*parseInt(amount);
                        console.log("name:" + name + " " + "amount:" + amount + " " + "cycle:Half Yearly");
                        card += "<div>Cycle"+" "+ cycle + "</div>";
                        card +="<select class='input'><option value='Sem1'>Sem1</option><option value='Sem2'>Sem2</option></select>";
                    }
                    else if (cycle_num == '3') {
                        console.log("name:" + name + " " + "amount:" + amount + " " + "cycle:Monthly");
                        card += "<div>Cycle:"+" " + cycle + "</div>";
                        card +="<select class='input'><option value='Jan'>Jan</option><option value='Feb'>Feb</option></select>";
                    }
                    card += "</div>";
                    
                    $('#data').append(card);
                }
            }

            $('.total').html("<h3>Total:â‚¹"+total+"/-</h3>");
        });

        $('input[type="radio"]').on('change', function() {
          $('input[name="' + this.name + '"]').not(this).prop('checked', false);
          var value = this.value;
        if(value=="cheque"){
            html="<input class='input' placeholder='cheque no' type='text'/>";
            $('.actions').html(html);
        }
        else if(value=="bank"){
            html="<input class='input' placeholder='Slip no' type='text'/>";
            html+="<input class='input' placeholder='cheque no' type='text'/>";
            $('.actions').html(html);
        }
        else if(value=="cash"){
            $('.actions').html('');
        }
        });
       
        
    </script> {% endblock %}